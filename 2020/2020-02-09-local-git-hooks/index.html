<!DOCTYPE html><html><head><meta charSet="utf-8"/><meta http-equiv="x-ua-compatible" content="ie=edge"/><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"/><meta name="generator" content="Gatsby 2.19.12"/><style data-styled="" data-styled-version="5.0.0">.dtlUne{position:relative;text-align:left;margin:1em 0;padding:0.5em;overflow-x:auto;border-radius:3px;font-family:'Courier New',Courier,monospace;}
.dtlUne .token-lline{line-height:1.3em;height:1.3em;}
data-styled.g1[id="Code__Pre-qgjj2j-0"]{content:"dtlUne,"}
.kalapB{display:inline-block;width:2em;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;opacity:0.3;}
data-styled.g2[id="Code__LineNo-qgjj2j-1"]{content:"kalapB,"}
.hHISGz{position:absolute;right:0.25rem;border:0;border-radius:3px;margin:0.25em;opacity:0.3;}
.hHISGz:hover{opacity:1;}
data-styled.g3[id="Code__CopyCode-qgjj2j-2"]{content:"hHISGz,"}
.hTEYHR{width:800px;margin:0 auto;}
data-styled.g4[id="Layout__AppStyles-ofllyx-0"]{content:"hTEYHR,"}
</style><link as="script" rel="preload" href="/techblog/webpack-runtime-32416f10351aa1627f16.js"/><link as="script" rel="preload" href="/techblog/commons-487d38bec414ba5177c2.js"/><link as="script" rel="preload" href="/techblog/app-dcbd940231e6cb5a8245.js"/><link as="script" rel="preload" href="/techblog/component---src-templates-blog-post-template-js-595d0789709c8fe06980.js"/><link as="fetch" rel="preload" href="/techblog/page-data/2020/2020-02-09-local-git-hooks/page-data.json" crossorigin="anonymous"/></head><body><div id="___gatsby"><div style="outline:none" tabindex="-1" role="group" id="gatsby-focus-wrapper"><main class="Layout__AppStyles-ofllyx-0 hTEYHR"><a href="/techblog/"><h1>Technical Blog</h1><p>This is my coding blog where I write about my cloud journey.</p></a><h1>Using linters against staged git files</h1><p>2020 February 9th</p><p>After annoying myself many many times what a build fails on a CI server went there are simple linting failures, I decided to do a bit of research to see if it could be automated for staged files before commit.</p><p>I&#x27;ve been using <code>prettier</code> in Visual Code Studio for some time and liked it, but it does rely on every developer within the project setting things up.</p><h2>pre-commit checks</h2><p>Pre-commit checks run after staging your changes and running git commit and before a commit is completed. If the checks fail then the commit is not made and an error shown, while if all checks pass the commit is made as normal.</p><h2>lint-stage</h2><p>Then I found <a href="https://github.com/okonet/lint-staged">lint-stage</a>, which seem to be exactly what I wanted.</p><h3>Setup</h3><p>running:
<code>npx mrm lint-staged</code></p><p>is the quickest way to get it running. This will install husky and lint-staged, then add a configuration to the project’s package.json that will automatically format supported files in a pre-commit hook.</p><p>This will automatically to you package.json for you.</p><pre class="Code__Pre-qgjj2j-0 dtlUne prism-code language-json" style="color:#d6deeb;background-color:#011627"><button class="Code__CopyCode-qgjj2j-2 hHISGz">Copy</button><div class="token-line" style="color:#d6deeb"><span class="Code__LineNo-qgjj2j-1 kalapB">1</span><span class="token property" style="color:rgb(128, 203, 196)">&quot;husky&quot;</span><span class="token operator" style="color:rgb(127, 219, 202)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="Code__LineNo-qgjj2j-1 kalapB">2</span><span class="token plain">    </span><span class="token property" style="color:rgb(128, 203, 196)">&quot;hooks&quot;</span><span class="token operator" style="color:rgb(127, 219, 202)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="Code__LineNo-qgjj2j-1 kalapB">3</span><span class="token plain">      </span><span class="token property" style="color:rgb(128, 203, 196)">&quot;pre-commit&quot;</span><span class="token operator" style="color:rgb(127, 219, 202)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(173, 219, 103)">&quot;lint-staged&quot;</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="Code__LineNo-qgjj2j-1 kalapB">4</span><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="Code__LineNo-qgjj2j-1 kalapB">5</span><span class="token plain">  </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="Code__LineNo-qgjj2j-1 kalapB">6</span><span class="token plain">  </span><span class="token property" style="color:rgb(128, 203, 196)">&quot;lint-staged&quot;</span><span class="token operator" style="color:rgb(127, 219, 202)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="Code__LineNo-qgjj2j-1 kalapB">7</span><span class="token plain">    </span><span class="token property" style="color:rgb(128, 203, 196)">&quot;*.{js,css,md}&quot;</span><span class="token operator" style="color:rgb(127, 219, 202)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(173, 219, 103)">&quot;prettier --write&quot;</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="Code__LineNo-qgjj2j-1 kalapB">8</span><span class="token plain">  </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span></div></pre><blockquote><p>you need to have eslint and/or prettier installed
<code>npx install-peerdeps --dev eslint-config-airbnb</code> - airbnb is the gold standard of javascript linting rules
<code>npm install -D eslint-config-prettier eslint-plugin-prettier</code>
Create .eslintrc.json file in your project’s root directory:</p><pre class="Code__Pre-qgjj2j-0 dtlUne prism-code language-undefined" style="color:#d6deeb;background-color:#011627"><button class="Code__CopyCode-qgjj2j-2 hHISGz">Copy</button><div class="token-line" style="color:#d6deeb"><span class="Code__LineNo-qgjj2j-1 kalapB">1</span><span class="token plain">{</span></div><div class="token-line" style="color:#d6deeb"><span class="Code__LineNo-qgjj2j-1 kalapB">2</span><span class="token plain">  &quot;extends&quot;: [&quot;airbnb&quot;, &quot;prettier&quot;],</span></div><div class="token-line" style="color:#d6deeb"><span class="Code__LineNo-qgjj2j-1 kalapB">3</span><span class="token plain">  &quot;plugins&quot;: [&quot;prettier&quot;],</span></div><div class="token-line" style="color:#d6deeb"><span class="Code__LineNo-qgjj2j-1 kalapB">4</span><span class="token plain">  &quot;rules&quot;: {</span></div></pre></blockquote><pre class="Code__Pre-qgjj2j-0 dtlUne prism-code language-undefined" style="color:#d6deeb;background-color:#011627"><button class="Code__CopyCode-qgjj2j-2 hHISGz">Copy</button><div class="token-line" style="color:#d6deeb"><span class="Code__LineNo-qgjj2j-1 kalapB">1</span><span class="token plain">&quot;prettier/prettier&quot;: [&quot;error&quot;]</span></div></pre><p>}
}</p><pre class="Code__Pre-qgjj2j-0 dtlUne prism-code language-undefined" style="color:#d6deeb;background-color:#011627"><button class="Code__CopyCode-qgjj2j-2 hHISGz">Copy</button><div class="token-line" style="color:#d6deeb"><span class="Code__LineNo-qgjj2j-1 kalapB">1</span><span class="token plain">&gt; before running the above commands. It will then set up your package.json for you :)</span></div><div class="token-line" style="color:#d6deeb"><span class="Code__LineNo-qgjj2j-1 kalapB">2</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line" style="color:#d6deeb"><span class="Code__LineNo-qgjj2j-1 kalapB">3</span><span class="token plain">### Commit code</span></div><div class="token-line" style="color:#d6deeb"><span class="Code__LineNo-qgjj2j-1 kalapB">4</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line" style="color:#d6deeb"><span class="Code__LineNo-qgjj2j-1 kalapB">5</span><span class="token plain">When committing code the hook with automatically run and fix any linting errors</span></div><div class="token-line" style="color:#d6deeb"><span class="Code__LineNo-qgjj2j-1 kalapB">6</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line" style="color:#d6deeb"><span class="Code__LineNo-qgjj2j-1 kalapB">7</span><span class="token plain">```sh</span></div><div class="token-line" style="color:#d6deeb"><span class="Code__LineNo-qgjj2j-1 kalapB">8</span><span class="token plain">xxx@xxx techblog % git commit -m &quot;staged-lint&quot;</span></div><div class="token-line" style="color:#d6deeb"><span class="Code__LineNo-qgjj2j-1 kalapB">9</span><span class="token plain">husky &gt; pre-commit (node v12.13.1)</span></div><div class="token-line" style="color:#d6deeb"><span class="Code__LineNo-qgjj2j-1 kalapB">10</span><span class="token plain">  ✔ Preparing...</span></div><div class="token-line" style="color:#d6deeb"><span class="Code__LineNo-qgjj2j-1 kalapB">11</span><span class="token plain">  ✔ Running tasks...</span></div><div class="token-line" style="color:#d6deeb"><span class="Code__LineNo-qgjj2j-1 kalapB">12</span><span class="token plain">  ✔ Applying modifications...</span></div><div class="token-line" style="color:#d6deeb"><span class="Code__LineNo-qgjj2j-1 kalapB">13</span><span class="token plain">  ✔ Cleaning up...</span></div><div class="token-line" style="color:#d6deeb"><span class="Code__LineNo-qgjj2j-1 kalapB">14</span><span class="token plain">[master 4080f84] staged-lint</span></div><div class="token-line" style="color:#d6deeb"><span class="Code__LineNo-qgjj2j-1 kalapB">15</span><span class="token plain"> 5 files changed, 57 insertions(+), 50 deletions(-)</span></div></pre><a href="/techblog/2020/2020-02-04-custom-resources/"><p>Cloudformation custom resources taking hours to timeout</p></a></main></div></div><script id="gatsby-script-loader">/*<![CDATA[*/window.pagePath="/2020/2020-02-09-local-git-hooks/";/*]]>*/</script><script id="gatsby-chunk-mapping">/*<![CDATA[*/window.___chunkMapping={"app":["/app-dcbd940231e6cb5a8245.js"],"component---src-templates-blog-post-template-js":["/component---src-templates-blog-post-template-js-595d0789709c8fe06980.js"],"component---src-pages-index-js":["/component---src-pages-index-js-b1f715f6ec8816250040.js"]};/*]]>*/</script><script src="/techblog/component---src-templates-blog-post-template-js-595d0789709c8fe06980.js" async=""></script><script src="/techblog/app-dcbd940231e6cb5a8245.js" async=""></script><script src="/techblog/commons-487d38bec414ba5177c2.js" async=""></script><script src="/techblog/webpack-runtime-32416f10351aa1627f16.js" async=""></script></body></html>